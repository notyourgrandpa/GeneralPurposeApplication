<form [formGroup]="form" class="pos-form">
  <!-- Dark header bar -->
  <header class="pos-header">
    <h1>{{ title }}</h1>
  </header>

  <div class="pos-container">

    <!-- Left: product search + cart -->
    <section class="pos-left">


      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Customer</mat-label>
        <input type="text" matInput [matAutocomplete]="auto"
               formControlName="customer" placeholder="Search customer">
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCustomer">
          <mat-option *ngFor="let c of filteredCustomers | async" [value]="c">
            {{ c.name }} – {{ c.contactNumber }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Search Product</mat-label>
        <input type="text" matInput [matAutocomplete]="auto1" [formControl]="productSearch">
        <mat-autocomplete #auto1="matAutocomplete"
                          [displayWith]="displayProduct"
                          (optionSelected)="onProductSelected($event)">
          <mat-option *ngFor="let p of filteredProducts | async" [value]="p">
            {{ p.name }} – {{ p.sellingPrice | currency:'PHP':'symbol' }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <button mat-raised-button color="primary" type="button" (click)="addProduct()"
              class="add-btn">
        Add +
      </button>

      <!-- Items Table -->
      <table mat-table [dataSource]="dataSource" formArrayName="items" class="mat-elevation-z2">
        <ng-container matColumnDef="product">
          <th mat-header-cell *matHeaderCellDef>Product</th>
          <td mat-cell *matCellDef="let row">{{ row.value.product.name }}</td>
        </ng-container>
        <ng-container matColumnDef="qty">
          <th mat-header-cell *matHeaderCellDef>Qty</th>
          <td mat-cell *matCellDef="let row; let i = index">
            <input matInput type="number" min="1" [formControl]="row.get('qty')" (input)="updateSubtotal(i)" />
          </td>
        </ng-container>
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let row">{{ row.value.price | currency:'PHP':'symbol' }}</td>
        </ng-container>
        <ng-container matColumnDef="subtotal">
          <th mat-header-cell *matHeaderCellDef>Subtotal</th>
          <td mat-cell *matCellDef="let row">{{ row.value.subtotal | currency:'PHP':'symbol' }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let row; let i = index">
            <button mat-icon-button color="warn" (click)="removeItem(i)">
              <mat-icon>close</mat-icon>
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['product','qty','price','subtotal','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['product','qty','price','subtotal','actions']"></tr>
      </table>
    </section>

    <!-- Right: totals & payment -->
    <aside class="pos-right">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Payment Method</mat-label>
        <mat-select formControlName="paymentMethod">
          <mat-option value="Cash">Cash</mat-option>
          <mat-option value="GCash">GCash</mat-option>
        </mat-select>
      </mat-form-field>

      <p class="pos-total">Total: {{ total | currency:'PHP':'symbol' }}</p>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Paid Amount</mat-label>
        <input type="number" matInput formControlName="paidAmount">
      </mat-form-field>

      <p class="pos-change">Change: {{ change | currency:'PHP':'symbol' }}</p>

      <div class="pos-actions">
        <button mat-raised-button color="primary" type="submit">
          Save Transaction
        </button>
        <button mat-stroked-button routerLink="/sales">Cancel</button>
      </div>
    </aside>
  </div>
</form>
